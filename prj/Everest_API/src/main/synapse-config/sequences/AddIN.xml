<?xml version="1.0" encoding="UTF-8"?>
<sequence name="AddIN" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <script language="js"><![CDATA[//
    	var payload  = mc.getPayloadXML()
    	mc.setProperty("payload", payload)]]></script>
    <log level="custom">
        <property expression="get-property('payload')" name="payload"/>
        <property expression="$body/jsonObject" name="body"/>
    </log>
    <filter regex="y" source="get-property('transport', 'createFoldersFirst')">
        <then>
            <iterate continueParent="true" expression="$body/jsonObject" sequential="true">
                <target sequence="createFolders"/>
            </iterate>
        </then>
        <else>
            <clone continueParent="true">
                <target sequence="createFolders"/>
            </clone>
        </else>
    </filter>
    <clone continueParent="true">
        <target sequence="AddResources"/>
    </clone>
    <loopback/>
</sequence>
